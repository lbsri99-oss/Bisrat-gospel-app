<!DOCTYPE html>
<html lang="am">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ወንጌል ለእኔ - Premium</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        /* --- 1. VARIABLES & THEME --- */
        :root {
            --primary: #4f46e5;
            --primary-light: #e0e7ff;
            --secondary: #ec4899;
            --bg-body: #f3f4f6;
            --bg-card: #ffffff;
            --text-main: #111827;
            --text-muted: #6b7280;
            --radius-lg: 24px;
            --radius-md: 16px;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --nav-height: 80px;
            --header-height: 70px;
            --safe-area-bottom: env(safe-area-inset-bottom);
        }

        /* --- 2. RESET & BASE --- */
        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* --- 3. LAYOUT & ANIMATIONS --- */
        main {
            flex: 1;
            position: relative;
            overflow: hidden;
        }

        .page-container {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            padding: calc(var(--header-height) + 10px) 20px calc(var(--nav-height) + 20px) 20px;
            overflow-y: auto;
            opacity: 0; 
            visibility: hidden;
            transform: translateY(10px);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            background: var(--bg-body);
            -webkit-overflow-scrolling: touch;
        }

        .page-active { 
            opacity: 1; 
            visibility: visible; 
            transform: translateY(0); 
            z-index: 10; 
        }

        /* Scrollbar Hiding */
        .page-container::-webkit-scrollbar { width: 0px; background: transparent; }

        /* --- 4. COMPONENTS --- */

        /* Header */
        .app-header {
            position: fixed; top: 0; left: 0; width: 100%;
            height: var(--header-height);
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 20px;
            z-index: 50;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }
        .brand h1 { font-size: 22px; font-weight: 900; letter-spacing: -0.5px; }
        .brand span { color: var(--primary); }
        .brand small { display: block; font-size: 11px; color: var(--text-muted); font-weight: 600; text-transform: uppercase; letter-spacing: 1px; }

        /* Cards */
        .card {
            background: var(--bg-card);
            border-radius: var(--radius-md);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-sm);
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.5);
        }

        /* Hero Card */
        .hero-card {
            min-height: 220px;
            display: flex; flex-direction: column; justify-content: flex-end;
            color: white;
            box-shadow: 0 20px 25px -5px rgba(79, 70, 229, 0.3);
            border: none;
            border-radius: var(--radius-lg);
        }
        .hero-bg {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            object-fit: cover; z-index: 0;
            filter: brightness(0.55);
            transition: transform 10s ease;
        }
        .hero-content { position: relative; z-index: 1; }
        .pill { 
            background: rgba(255,255,255,0.2); backdrop-filter: blur(4px); 
            padding: 4px 12px; border-radius: 20px; font-size: 11px; font-weight: 700;
            display: inline-block; margin-bottom: 12px;
        }

        /* Feed Items */
        .feed-item {
            border-left: 4px solid var(--primary);
            transition: transform 0.2s;
        }
        .feed-item:active { transform: scale(0.98); }
        .feed-meta { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 12px; color: var(--text-muted); }
        .feed-tag { color: var(--primary); font-weight: bold; background: var(--primary-light); padding: 2px 8px; border-radius: 6px; }

        /* Buttons & Inputs */
        .btn {
            width: 100%; padding: 16px; border-radius: var(--radius-md);
            border: none; font-weight: 700; font-size: 15px; cursor: pointer;
            display: flex; align-items: center; justify-content: center; gap: 10px;
            transition: all 0.2s;
        }
        .btn-primary { background: var(--text-main); color: white; }
        .btn-primary:active { transform: scale(0.97); opacity: 0.9; }
        
        .input-group { margin-bottom: 16px; }
        .form-input {
            width: 100%; padding: 16px; background: var(--bg-body);
            border: 2px solid transparent; border-radius: var(--radius-md);
            font-size: 15px; outline: none; transition: 0.2s;
        }
        .form-input:focus { border-color: var(--primary); background: white; }

        /* Navigation */
        .nav-bar {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 400px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 30px;
            height: 65px;
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            z-index: 100;
            border: 1px solid rgba(255,255,255,0.4);
        }
        .nav-btn {
            background: transparent; border: none; color: #9ca3af;
            width: 50px; height: 50px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 20px; transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .nav-btn.active {
            background: var(--text-main); color: white;
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        /* Typography & Utilities */
        h2, h3, h4 { color: var(--text-main); margin-bottom: 8px; }
        p { line-height: 1.6; color: var(--text-muted); font-size: 14px; }
        .section-header { display: flex; justify-content: space-between; align-items: center; margin: 25px 0 15px 0; }
        .section-title { font-size: 18px; font-weight: 800; margin: 0; }
        .text-gradient { background: linear-gradient(135deg, #4f46e5, #ec4899); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .hidden { display: none !important; }
        
        /* Loading Skeleton */
        .skeleton { background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%); background-size: 200% 100%; animation: loading 1.5s infinite; color: transparent !important; border-radius: 4px; }
        @keyframes loading { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
    </style>
</head>
<body>

    <header class="app-header">
        <div class="brand">
            <small>እንኳን ደህና መጡ</small>
            <h1>ወንጌል<span>ለእኔ</span></h1>
        </div>
        <div style="width: 40px; height: 40px; background: #f3f4f6; border-radius: 50%; display: grid; place-items: center;">
            <i class="fas fa-bell" style="color: #666;"></i>
        </div>
    </header>

    <main>
        <article id="tab-home" class="page-container page-active">
            
            <section class="card hero-card">
                <img src="https://images.unsplash.com/photo-1438232992991-995b7058bbb3?q=80&w=800&auto=format&fit=crop" class="hero-bg" loading="lazy" alt="Worship">
                <div class="hero-content">
                    <span class="pill">የዕለቱ ቃል</span>
                    <h2 id="verseText" class="skeleton" style="min-height: 60px; font-size: 18px; text-shadow: 0 2px 4px rgba(0,0,0,0.5);">እየተጫነ ነው...</h2>
                    <div style="border-top: 1px solid rgba(255,255,255,0.3); margin-top: 10px; padding-top: 10px; display: flex; justify-content: space-between;">
                        <span id="verseRef" style="font-weight: 700;">...</span>
                        <i class="fas fa-share-alt"></i>
                    </div>
                </div>
            </section>

            <div class="section-header">
                <h3 class="section-title">ታሪካዊ መነቃቃት</h3>
                <span class="feed-tag" style="background: #fee2e2; color: #ef4444;">ተነሳ!</span>
            </div>

            <section class="card" style="padding: 0;">
                <div style="position: relative; height: 160px;">
                    <img src="https://images.unsplash.com/photo-1511671782779-c97d3d27a1d4?q=80&w=800&auto=format&fit=crop" style="width:100%; height:100%; object-fit: cover;" loading="lazy" alt="Revival">
                    <span class="pill" style="position:absolute; top:10px; left:10px; background: #dc2626; color: white;">1907 - ኮሪያ</span>
                </div>
                <div style="padding: 20px;">
                    <h4 style="font-weight: 800;">የፒዮንግያንግ ታላቁ መነቃቃት</h4>
                    <p>በ1907 ዓ.ም በሰሜን ኮሪያ (ፒዮንግያንግ) የተነሳው መንፈሳዊ እንቅስቃሴ እስያ ያለችበትን መንፈሳዊ ቁመና ቀየረው።</p>
                </div>
            </section>

            <div class="section-header">
                <h3 class="section-title">የኃይል ምንጭ</h3>
                <small style="color: var(--primary); font-weight: bold;">የዛሬ መልዕክቶች</small>
            </div>
            <div id="feedList"></div>
            <div style="height: 50px;"></div> </article>

        <article id="tab-training" class="page-container">
            <h2 class="section-title" style="font-size: 24px;">የስልጠና ማዕከል</h2>
            <p style="margin-bottom: 20px;">ለአገልግሎት እና ለመንፈሳዊ እድገት የሚሆኑ ግብዓቶች</p>

            <img src="https://images.unsplash.com/photo-1491841550275-ad7854e35ca6?q=80&w=800&auto=format&fit=crop" style="width:100%; height: 140px; object-fit: cover; border-radius: var(--radius-md); margin-bottom: 20px;" loading="lazy" alt="Bible Study">

            <div style="display: grid; grid-template-columns: 1fr; gap: 15px;">
                <div class="card" style="display: flex; gap: 15px; align-items: center; margin: 0;">
                    <div style="min-width: 50px; height: 50px; background: #ffedd5; border-radius: 12px; display: grid; place-items: center; color: #f97316; font-size: 20px;">
                        <i class="fas fa-fire"></i>
                    </div>
                    <div>
                        <h4 style="margin:0; font-size: 16px;">የወንጌል እሳት</h4>
                        <p style="margin:0; font-size: 12px;">እንዴት በወንጌል መቃጠል እንችላለን?</p>
                    </div>
                </div>
                <div class="card" style="display: flex; gap: 15px; align-items: center; margin: 0;">
                    <div style="min-width: 50px; height: 50px; background: #dbeafe; border-radius: 12px; display: grid; place-items: center; color: #3b82f6; font-size: 20px;">
                        <i class="fas fa-users"></i>
                    </div>
                    <div>
                        <h4 style="margin:0; font-size: 16px;">ደቀመዝሙርነት</h4>
                        <p style="margin:0; font-size: 12px;">ሰዎችን ወደ ክርስቶስ መምራት</p>
                    </div>
                </div>
            </div>

            <div class="section-header">
                <h3 class="section-title">ታላላቅ መነቃቃቶች</h3>
            </div>
            <div id="historyList">
                </div>
            <div style="height: 50px;"></div>
        </article>

        <article id="tab-register" class="page-container">
            <div class="card" style="text-align: center; padding: 40px 20px; border: 1px solid var(--primary-light);">
                <div style="width: 80px; height: 80px; background: var(--primary-light); color: var(--primary); border-radius: 50%; display: grid; place-items: center; margin: 0 auto 20px auto; font-size: 30px;">
                    <i class="fas fa-hand-holding-heart"></i>
                </div>
                <h2 style="font-size: 22px; font-weight: 800;">የአገልጋይነት ምዝገባ</h2>
                <p>አብረን እንስራ፣ መንግስቱን እናስፋ</p>
            </div>

            <form id="regForm" class="card">
                <div class="input-group">
                    <label style="display: block; margin-bottom: 8px; font-weight: bold; font-size: 13px;">ሙሉ ስም</label>
                    <input id="fullName" type="text" class="form-input" placeholder="ስምዎን ያስገቡ" required>
                </div>
                <div class="input-group">
                    <label style="display: block; margin-bottom: 8px; font-weight: bold; font-size: 13px;">ስልክ ቁጥር</label>
                    <input id="phone" type="tel" class="form-input" placeholder="09..." required>
                </div>
                <div class="input-group">
                    <label style="display: block; margin-bottom: 8px; font-weight: bold; font-size: 13px;">የአገልግሎት ዘርፍ</label>
                    <select id="role" class="form-input" required>
                        <option value="">ይምረጡ...</option>
                        <option value="Evangelist">ወንጌላዊ</option>
                        <option value="Coordinator">አስተባባሪ</option>
                        <option value="Prayer Warrior">የጸሎት ወታደር</option>
                        <option value="Choir">መዘምራን</option>
                    </select>
                </div>
                <button type="submit" id="submitBtn" class="btn btn-primary">
                    <span>ይመዝገቡ</span> <i class="fas fa-arrow-right"></i>
                </button>
            </form>
        </article>

        <article id="tab-admin" class="page-container">
            <div id="adminLogin" style="text-align: center; margin-top: 50px;">
                <div style="width: 70px; height: 70px; background: white; border-radius: 20px; box-shadow: var(--shadow-lg); display: grid; place-items: center; margin: 0 auto 20px auto;">
                    <i class="fas fa-lock" style="font-size: 24px; color: var(--text-main);"></i>
                </div>
                <h3>Admin Access</h3>
                <p style="margin-bottom: 20px;">Please enter your PIN</p>
                <div style="display: flex; justify-content: center; gap: 10px; margin-bottom: 20px;">
                    <input id="adminPin" type="password" maxlength="4" style="width: 120px; letter-spacing: 10px; text-align: center; font-size: 24px; border: none; background: white; padding: 10px; border-radius: 10px; box-shadow: var(--shadow-sm);" placeholder="••••">
                </div>
                <button id="unlockBtn" class="btn btn-primary" style="width: auto; margin: 0 auto; padding: 12px 30px;">Unlock</button>
            </div>

            <div id="adminData" class="hidden">
                <div class="card" style="background: #1f2937; color: white;">
                    <p style="text-transform: uppercase; font-size: 11px; letter-spacing: 2px; opacity: 0.7;">Total Registered</p>
                    <h1 id="totalCount" style="font-size: 42px; margin: 5px 0 0 0; color: white;">...</h1>
                    <div style="position: absolute; right: 20px; top: 20px; opacity: 0.2;">
                        <i class="fas fa-users" style="font-size: 50px;"></i>
                    </div>
                </div>

                <div class="section-header">
                    <h3 class="section-title">Recent Users</h3>
                    <button id="refreshAdmin" style="background:none; border:none; color:var(--primary); font-weight:bold;">Refresh</button>
                </div>
                <div id="adminList"></div>
            </div>
            <div style="height: 50px;"></div>
        </article>
    </main>

    <nav class="nav-bar">
        <button data-target="home" class="nav-btn active" aria-label="Home"><i class="fas fa-home"></i></button>
        <button data-target="training" class="nav-btn" aria-label="Training"><i class="fas fa-book-open"></i></button>
        <button data-target="register" class="nav-btn" aria-label="Register"><i class="fas fa-plus"></i></button>
        <button data-target="admin" class="nav-btn" aria-label="Admin"><i class="fas fa-cog"></i></button>
    </nav>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, serverTimestamp, orderBy } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";

        // --- Configuration ---
        const firebaseConfig = {
            apiKey: "AIzaSyAC_PXjxU24c7yf8thr0eZyNFI06peTQ5g",
            authDomain: "bsri-gospel-app.firebaseapp.com",
            projectId: "bsri-gospel-app",
            storageBucket: "bsri-gospel-app.firebasestorage.app",
            messagingSenderId: "145666666795",
            appId: "1:145666666795:web:67b6e75fc7fe7dc97bd56e"
        };

        // --- State & Data ---
        const AppState = {
            db: null,
            isAdminUnlocked: false,
            verses: [
                { t: "በእርሱ የሚያምን ሁሉ የዘላለም ሕይወት እንዲኖረው እንጂ እንዳይጠፋ እግዚአብሔር አንድያ ልጁን እስኪሰጥ ድረስ ዓለሙን እንዲሁ ወዶአልና።", r: "ዮሐንስ 3:16" },
                { t: "እግዚአብሔር እረኛዬ ነው፥ የሚያሳጣኝም የለም። በለመለመ መስክ ያሳድረኛል፤ በዕረፍት ውሃ ዘንድ ይመራኛል።", r: "መዝሙር 23:1-2" },
                { t: "ብርታቴና ዝማሬዬ እግዚአብሔር ነው፤ እርሱም መድኃኒት ሆነልኝ።", r: "መዝሙር 118:14" }
            ],
            history: [
                { title: "የዌልስ መነቃቃት (1904)", body: "ኢቫን ሮበርትስ 'እኔን ስበረኝ' ብሎ በጸለየው ጸሎት 100,000 ሰዎች ወደ ጌታ መጡ።", color: "#ec4899" },
                { title: "የአዙሳ ስትሪት (1906)", body: "ዊሊያም ሲሞር በጀመረው የጸሎት ንቅናቄ ዘመናዊው የጴንጤቆስጤ እንቅስቃሴ ተወለደ።", color: "#f59e0b" },
                { title: "የኢትዮጵያ መነቃቃት (1960s)", body: "በስደት ውስጥ የበዛች ቤተክርስቲያን። ለወንጌል የተከፈለ ዋጋ።", color: "#10b981" },
            ]
        };

        // --- UI Controller ---
        const UI = {
            init: () => {
                UI.renderVerse();
                UI.renderFeed();
                UI.renderHistory();
                UI.setupNavigation();
                UI.setupForms();
            },

            renderVerse: () => {
                const idx = new Date().getDate() % AppState.verses.length;
                const v = AppState.verses[idx];
                const textEl = document.getElementById('verseText');
                
                // Simulate loading for effect
                setTimeout(() => {
                    textEl.classList.remove('skeleton');
                    textEl.innerText = `"${v.t}"`;
                    document.getElementById('verseRef').innerText = v.r;
                }, 500);
            },

            renderFeed: () => {
                const list = document.getElementById('feedList');
                const posts = [
                    { t: "የወንጌል አደራ", b: "ወንጌልን አለመስበክ በሰው ላይ ከመፍረድ ይቆጠራል።", a: "ቢኒያም" },
                    { t: "የጸሎት ኃይል", b: "ጉልበታችን የሚበረታው በጉልበታችን ስንሆን ነው።", a: "ሣራ" },
                    { t: "ፍቅር ያሸንፋል", b: "ፍቅር ታጋሽ ነው፥ ፍቅር ቸር ነው።", a: "ዳዊት" }
                ];
                
                list.innerHTML = posts.map(p => `
                    <div class="card feed-item">
                        <div class="feed-meta">
                            <span class="feed-tag">መልዕክት</span>
                            <span><i class="fas fa-user-circle"></i> ${p.a}</span>
                        </div>
                        <h3 style="font-size:16px;">${p.t}</h3>
                        <p style="margin:0; font-size:13px;">${p.b}</p>
                    </div>
                `).join('');
            },

            renderHistory: () => {
                const container = document.getElementById('historyList');
                container.innerHTML = AppState.history.map(h => `
                    <div class="card" style="border-left: 4px solid ${h.color};">
                        <h4 style="color:${h.color}; margin-bottom: 5px;">${h.title}</h4>
                        <p style="font-size:13px;">${h.body}</p>
                    </div>
                `).join('');
            },

            setupNavigation: () => {
                document.querySelectorAll('.nav-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const targetId = btn.getAttribute('data-target');
                        
                        // Update UI Buttons
                        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');

                        // Update Page Visibility
                        document.querySelectorAll('.page-container').forEach(p => p.classList.remove('page-active'));
                        document.getElementById(`tab-${targetId}`).classList.add('page-active');
                        
                        // Scroll top
                        window.scrollTo(0,0);
                    });
                });
            },

            setupForms: () => {
                // Registration
                const form = document.getElementById('regForm');
                form.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    if(!AppState.db) return alert("Database initializing...");
                    
                    const btn = document.getElementById('submitBtn');
                    const originalText = btn.innerHTML;
                    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                    btn.disabled = true;

                    try {
                        await addDoc(collection(AppState.db, 'registrations'), {
                            name: document.getElementById('fullName').value,
                            phone: document.getElementById('phone').value,
                            role: document.getElementById('role').value,
                            createdAt: serverTimestamp()
                        });
                        alert("ተመዝግበዋል! እግዚአብሔር ይባርክዎ።");
                        form.reset();
                        document.querySelector('[data-target="home"]').click(); // Go home
                    } catch (err) {
                        console.error(err);
                        alert("Error: " + err.message);
                    } finally {
                        btn.innerHTML = originalText;
                        btn.disabled = false;
                    }
                });

                // Admin Unlock
                document.getElementById('unlockBtn').addEventListener('click', () => {
                    const pin = document.getElementById('adminPin').value;
                    if(pin === '9876') {
                        document.getElementById('adminLogin').classList.add('hidden');
                        document.getElementById('adminData').classList.remove('hidden');
                        UI.loadAdminData();
                    } else {
                        alert("Incorrect PIN");
                        document.getElementById('adminPin').value = '';
                    }
                });
            },

            loadAdminData: () => {
                if(!AppState.db) return;
                const q = query(collection(AppState.db, 'registrations'), orderBy('createdAt', 'desc'));
                
                onSnapshot(q, (snapshot) => {
                    document.getElementById('totalCount').innerText = snapshot.size;
                    const list = document.getElementById('adminList');
                    
                    list.innerHTML = snapshot.docs.map(doc => {
                        const d = doc.data();
                        return `
                            <div class="card" style="padding: 15px; display:flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <h4 style="font-size: 14px; margin:0;">${d.name}</h4>
                                    <small style="color: #6b7280;">${d.phone}</small>
                                </div>
                                <span style="font-size:10px; background:#e0e7ff; color:#4338ca; padding:4px 8px; border-radius:4px;">${d.role}</span>
                            </div>
                        `;
                    }).join('');
                });
            }
        };

        // --- Main Execution ---
        try {
            const app = initializeApp(firebaseConfig);
            AppState.db = getFirestore(app);
            UI.init();
        } catch (e) {
            console.error("Firebase init failed", e);
            alert("App failed to connect to database.");
        }
    </script>
</body>
</html>
